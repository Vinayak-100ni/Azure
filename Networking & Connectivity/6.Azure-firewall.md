1️⃣ Create Virtual Network (VNet)
Azure Portal

Go to Azure Portal → Virtual networks → Create

Fill:

Name: my-vnet

Region: same region you’ll use for VM & Firewall

Address space: 10.0.0.0/16

Click Next

2️⃣ Create Subnets
Subnet 1 – For VM

Name: vm-subnet

Address range: 10.0.1.0/24

Subnet 2 – For Firewall (MANDATORY NAME)

Name: AzureFirewallSubnet

Address range: 10.0.2.0/24
⚠️ Subnet name must be exactly AzureFirewallSubnet

Finish VNet creation.

3️⃣ Create Virtual Machine (in vm-subnet)

Create → Virtual Machine

During Networking tab:

VNet: my-vnet

Subnet: vm-subnet

Public IP: Optional (not required if using Firewall NAT)

Complete VM creation

4️⃣ Create Azure Firewall
Azure Portal

Create → Azure Firewall

Basics:

Name: my-firewall

Region: same as VNet

Firewall SKU: Standard

VNet: my-vnet

Public IP:

Create new → fw-public-ip

Click Create

⏳ Firewall deployment may take 5–10 minutes.

5️⃣ Firewall NAT Rule Configuration

Path:

Azure Firewall → my-firewall
 → Settings → Rules
 → NAT rule collection

Create NAT Rule Collection

Click + Add NAT rule collection

Field	Value
Name	nat-collection-1
Priority	100
Action	DNAT
Add NAT Rule (Inside Collection)

Click Add rule

Field	Value (Example)
Name	dnat-ssh-vm
Protocol	TCP
Source type	IP Address
Source	* (or your public IP)
Destination Address	Firewall Public IP
Destination Ports	22
Translated Address	VM private IP (e.g. 10.0.1.4)
Translated Port	22

✅ Click Add

This means:

Internet → Firewall Public IP:22 → VM Private IP:22

6️⃣ (IMPORTANT) Add Route Table for VM Subnet

Without this, traffic won’t pass through the firewall.

Create Route Table

Create → Route table

Name: vm-fw-rt

Disable Propagate gateway routes

Add Route
Field	Value
Address prefix	0.0.0.0/0
Next hop type	Virtual appliance
Next hop address	Firewall private IP
Associate Route Table

Go to Route table → Subnets

Attach to vm-subnet

7️⃣ Validate

From your local system:

ssh username@<Firewall_Public_IP>
